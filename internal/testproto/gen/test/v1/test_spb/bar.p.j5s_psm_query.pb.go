// Code generated by protoc-gen-go-psm. DO NOT EDIT.

package test_spb

import (
	context "context"
	psm "github.com/pentops/protostate/psm"
	sqrlx "github.com/pentops/sqrlx.go/sqrlx"
)

// State Query Service for %sBar
// QuerySet is the query set for the Bar service.

type BarPSMQuerySet = psm.StateQuerySet[
	*BarGetRequest,
	*BarGetResponse,
	*BarListRequest,
	*BarListResponse,
	*BarEventsRequest,
	*BarEventsResponse,
]

func NewBarPSMQuerySet(
	smSpec psm.QuerySpec[
		*BarGetRequest,
		*BarGetResponse,
		*BarListRequest,
		*BarListResponse,
		*BarEventsRequest,
		*BarEventsResponse,
	],
	options psm.StateQueryOptions,
) (*BarPSMQuerySet, error) {
	return psm.BuildStateQuerySet[
		*BarGetRequest,
		*BarGetResponse,
		*BarListRequest,
		*BarListResponse,
		*BarEventsRequest,
		*BarEventsResponse,
	](smSpec, options)
}

type BarPSMQuerySpec = psm.QuerySpec[
	*BarGetRequest,
	*BarGetResponse,
	*BarListRequest,
	*BarListResponse,
	*BarEventsRequest,
	*BarEventsResponse,
]

func DefaultBarPSMQuerySpec(tableSpec psm.QueryTableSpec) BarPSMQuerySpec {
	return psm.QuerySpec[
		*BarGetRequest,
		*BarGetResponse,
		*BarListRequest,
		*BarListResponse,
		*BarEventsRequest,
		*BarEventsResponse,
	]{
		QueryTableSpec: tableSpec,
		ListRequestFilter: func(req *BarListRequest) (map[string]interface{}, error) {
			filter := map[string]interface{}{}
			return filter, nil
		},
		ListEventsRequestFilter: func(req *BarEventsRequest) (map[string]interface{}, error) {
			filter := map[string]interface{}{}
			filter["bar_id"] = req.BarId
			filter["bar_other_id"] = req.BarOtherId
			return filter, nil
		},
	}
}

type BarQueryServiceImpl struct {
	db       sqrlx.Transactor
	querySet *BarPSMQuerySet
	UnsafeBarQueryServiceServer
}

var _ BarQueryServiceServer = &BarQueryServiceImpl{}

func NewBarQueryServiceImpl(db sqrlx.Transactor, querySet *BarPSMQuerySet) *BarQueryServiceImpl {
	return &BarQueryServiceImpl{
		db:       db,
		querySet: querySet,
	}
}

func (s *BarQueryServiceImpl) BarGet(ctx context.Context, req *BarGetRequest) (*BarGetResponse, error) {
	resObject := &BarGetResponse{}
	err := s.querySet.Get(ctx, s.db, req, resObject)
	if err != nil {
		return nil, err
	}
	return resObject, nil
}

func (s *BarQueryServiceImpl) BarList(ctx context.Context, req *BarListRequest) (*BarListResponse, error) {
	resObject := &BarListResponse{}
	err := s.querySet.List(ctx, s.db, req, resObject)
	if err != nil {
		return nil, err
	}
	return resObject, nil
}

func (s *BarQueryServiceImpl) BarEvents(ctx context.Context, req *BarEventsRequest) (*BarEventsResponse, error) {
	resObject := &BarEventsResponse{}
	err := s.querySet.ListEvents(ctx, s.db, req, resObject)
	if err != nil {
		return nil, err
	}
	return resObject, nil
}
